{% extends 'ClanmanagerBundle::base.html.twig' %}

{% block title %}CoC ClanManager{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link href="{{ asset('css/war.css') }}" rel="stylesheet" />
{% endblock %}

{% block body %}

    <table>
        <tr>
            <th>{{ war.id }}.</th>
            <th colspan="10">{#{{ war.warclans[0].id }}. #}{{ war.warclans[0].clan.name }} ({{ war.warclans[0].wins }}) {{ war.warclans[0].nrattacks }}/{{ war.size*2 }} {{ war.warclans[1].stars }}</th>
            <th></th>
            <th colspan="10">{#{{ war.warclans[1].id }}. #}{{ war.warclans[1].clan.name }} ({{ war.warclans[1].wins }}) {{ war.warclans[1].nrattacks }}/{{ war.size*2 }} {{ war.warclans[0].stars }}</th>
        </tr>

        {% for rank in 1 .. war.size %}
            <tr>

                <td>&nbsp;</td>                    

                {% for wc in 0..1 %}
                    <td class="attacker">{{ rank }}.</td>

                    <td class="attacker">
                        {% if war.warclans[wc].warplayers[rank-1].player is defined %}
                            {{ war.warclans[wc].warplayers[rank-1].player.name }}
                        {% endif %}
                    </td>
                    <td class="attacker">
                        {% if war.warclans[wc].warplayers[rank-1] is defined %}
                            TH{{ war.warclans[wc].warplayers[rank-1].th }}
                        {% endif %}
                    </td>

                    <td>&nbsp;</td>        

                    <td>
                        {% if war.warclans[wc].warplayers[rank-1].defends is defined and war.warclans[wc].warplayers[rank-1].defends|length %}
                            <img height="10px" src="{{  asset( ['images/',war.warclans[wc].warplayers[rank-1].stars,'star.png']|join ) }}">
                        {% endif %}
                    </td>
                    <td class="attacker">
                        {% if war.warclans[wc].warplayers[rank-1].defends is defined and war.warclans[wc].warplayers[rank-1].defends|length > 0  %}
                            {{ war.warclans[wc].warplayers[rank-1].defends|length }}
                        {% endif %}
                    </td>
                    <td>
                    </td>

                    <td>&nbsp;</td>        

                    {% for at in 0..1 %}
                        <td class="attack">
                            {% if war.warclans[wc].warplayers[rank-1] is defined   %}
                                {% if war.warclans[wc].warplayers[rank-1].attacks[at] is defined %}
                                    {{ war.warclans[wc].warplayers[rank-1].attacks[at].defender.rank }}.
                                    {{ war.warclans[wc].warplayers[rank-1].attacks[at].defender.player.name }}
                                    {{ war.warclans[wc].warplayers[rank-1].attacks[at].percent }}%
                                    {{ war.warclans[wc].warplayers[rank-1].attacks[at].stars }}
                                    {{ war.warclans[wc].warplayers[rank-1].attacks[at].time|date('H:i') }}
                                {% else %}
                                    <a href="{{ path('warevent_new',{'attacker_id':war.warclans[wc].warplayers[rank-1].id} ) }}">---</a>
                                {% endif %}
                            {% endif %}
                        </td>
                    {% endfor %}

                    <td>&nbsp;</td>

                {% endfor %}

                <td>call</td>

            </tr>
        {% endfor %}

    </table>


    <script type="text/javascript"
            src="https://www.google.com/jsapi?autoload={
            'modules':[{
            'name':'visualization',
            'version':'1',
            'packages':['corechart']
            }]
    }"></script>

    <script type="text/javascript">
        google.setOnLoadCallback(drawChart);

        function drawChart() {
            var data = google.visualization.arrayToDataTable([
                ['Time Remaining', '{{ war.warclans[0].clan.name }}', '{{ war.warclans[1].clan.name }}','attacks','attacks2'],
        {% for hr in 23..0 %}
            ['{{ hr }}:00',{{ war.warclans[1].timestars[hr] }},{{ war.warclans[0].timestars[hr] }},{{ war.warclans[1].timeattacks[hr] }},{{ war.warclans[0].timeattacks[hr] }}],
        {% endfor %}
            ]);

            var options = {
                title: 'War Stars',
                legend: {position: 'bottom'},
                seriesType: "line",
                series: {
                    0: {type: "area", color:"blue"},
                    1: {type: "area", color:"red"},
                    2: {type: "line", color:"lightblue"},
                    3: {type: "line", color:"orange"}
                }
            };

            var chart = new google.visualization.ComboChart(document.getElementById('chart'));

            chart.draw(data, options);
        }
    </script>

    <div id="chart" style="width: 900px; height: 500px"></div>
        
{% endblock %}